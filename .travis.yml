language: go
go:
  - 1.12.x
addons:
  apt:
    packages:
      - rpm
      - snapd
env:
  global:
    - 'PATH=/snap/bin:$PATH'
    - GO111MODULE=on
services:
  - docker
install:
  - 'sudo snap install snapcraft --classic'
script: go test -coverprofile=coverage.txt -covermode=atomic -v ./...
after_success:
  - bash <(curl -s https://codecov.io/bash) -c
deploy:
  - provider: script
    skip_cleanup: true
    script: 'curl -sL https://git.io/goreleaser | bash'
    on:
      tags: true
      condition: '$TRAVIS_OS_NAME = linux'
